(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-414ade48"],{"023f":function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return r})),a.d(t,"d",(function(){return n})),a.d(t,"c",(function(){return s}));var i=a("b775");function l(e){return Object(i["a"])({url:"/biz/device/deviceAddOrUpdate",method:"post",data:e})}function r(e){return Object(i["a"])({url:"/biz/device/"+e,method:"delete"})}function n(){return Object(i["a"])({url:"/biz/device/getDeviceTemplate",method:"GET",responseType:"arraybuffer"})}function s(e){return Object(i["a"])({url:"/biz/device/deviceImport",method:"POST",data:e})}},"1a9b":function(e,t,a){"use strict";a("fcb1")},"294a":function(e,t,a){"use strict";a("1bc7");var i=a("b775");function l(e){return Object(i["a"])({url:"/admin/dict/type/"+e,method:"get"})}a.d(t,"a",(function(){return r}));var r={methods:{dict:function(e,t){l(e).then((function(e){var a=JSON.parse(JSON.stringify(e.data));a.forEach((function(e){t.push({value:parseInt(e.value),label:e.label})}))}))}}}},"50a3":function(e,t,a){},6935:function(e,t,a){"use strict";a("50a3")},8233:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-wrapper device-add-page-wrapper"},[a("s-title",{attrs:{title:"add"==e.title?"新增工单":"编辑工单"}}),e._v(" "),a("div",{staticClass:"user-add-container form-container"},[a("el-form",{ref:"form",staticClass:"demo-ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"140px"}},[a("el-form-item",{staticClass:"form-item",attrs:{label:"设备名称",prop:"deviceId"}},[a("el-col",{attrs:{span:24}},[a("el-input",{attrs:{placeholder:"请选择设备",disabled:"add"!=e.title},on:{focus:function(t){return e.todevice()}},model:{value:e.form.deviceName,callback:function(t){e.$set(e.form,"deviceName",t)},expression:"form.deviceName"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"报障人",prop:"faultUser"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.select2,"visible-change":e.tips},model:{value:e.form.faultUser,callback:function(t){e.$set(e.form,"faultUser",t)},expression:"form.faultUser"}},e._l(e.faultUser,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),a("el-form-item",{staticClass:"form-item",attrs:{label:"报障人电话",prop:"faultUserMobile"}},[a("el-input",{attrs:{placeholder:"请输入报障人电话",disabled:""},model:{value:e.form.faultUserMobile,callback:function(t){e.$set(e.form,"faultUserMobile",t)},expression:"form.faultUserMobile"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"工单状态",prop:"taskStatus"}},[a("el-select",{attrs:{placeholder:"请选择",disabled:""},on:{change:e.select3},model:{value:e.form.taskStatus,callback:function(t){e.$set(e.form,"taskStatus",t)},expression:"form.taskStatus"}},e._l(e.taskStatus,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"故障类型",prop:"faultType"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{focus:e.tips},model:{value:e.form.faultType,callback:function(t){e.$set(e.form,"faultType",t)},expression:"form.faultType"}},e._l(e.faultType,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"工单来源",prop:"taskScore"}},[a("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:e.form.taskScore,callback:function(t){e.$set(e.form,"taskScore",t)},expression:"form.taskScore"}},e._l(e.taskScore,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),a("el-form-item",{staticClass:"form-item",attrs:{label:"故障描述",prop:"faultDesc"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入故障描述"},on:{focus:e.tips},model:{value:e.form.faultDesc,callback:function(t){e.$set(e.form,"faultDesc",t)},expression:"form.faultDesc"}})],1),e._v(" "),a("el-form-item",{staticClass:"form-item",attrs:{label:"故障图片"}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"/admin/file/upload","on-exceed":e.handleExceed,multiple:"",limit:3,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"file-list":e.fileList,headers:e.myHeaders,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload,"list-type":"picture",accept:".jpg, .jpeg, .png, .gif, .bmp, .pdf, .JPG, .PBG, .GIF, .BMP, .PDF"},on:{focus:e.tips}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1)],1),e._v(" "),a("el-button",{staticClass:"common-add-btn",attrs:{type:"primary"},on:{click:function(t){return e.handleAdd()}}},[e._v("保存")])],1),e._v(" "),e.dialogVisible?a("bigimg",{attrs:{imgSrc:e.dialogImageUrl},on:{clickit:function(t){e.dialogVisible=!1}}}):e._e(),e._v(" "),a("el-dialog",{attrs:{visible:e.choosedevice,top:"2vh",width:"90%"},on:{"update:visible":function(t){e.choosedevice=t}}},[a("Device",{on:{deviceid:e.getdeviceid}})],1)],1)},l=[],r=(a("fc02"),a("a450"),a("1bc7"),a("e186"),a("2aab")),n=a("f8a4"),s=a("b405"),o=a("b7e7"),u=a("110a"),c=a("294a"),d=(a("61f7"),a("7e1e")),f=a("5f87"),p={name:"taskAdd",components:{STitle:s["default"],Device:o["default"],bigimg:u["default"]},mixins:[c["a"]],data:function(){return{choosedevice:!1,dialogImageUrl:"",dialogVisible:!1,devicename:"",deviceid:"",myHeaders:{},fileList:[],faultType:[],faultUserMobile:null,faultUser:null,phoneindex:0,peoplephone:null,taskStatus:[],taskScore:[],title:"add",deviceTypeOption:[],deviceUsesOption:[],faultMediaIdarr:[],form:{id:null,deviceId:null,taskStatus:null,faultType:null,faultDesc:null,faultMediaId:null,faultUser:null,taskScore:null,taskStatusName:null,faultUserMobile:null,deviceName:null},rules:m}},mounted:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,a,i,l,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=d["a"].taskStatus,t.forEach((function(e){r.taskStatus.push({value:parseInt(e.value),label:e.label})})),a=d["a"].faultType,a.forEach((function(e){r.faultType.push({value:parseInt(e.value),label:e.label})})),i=d["a"].taskScore,i.forEach((function(e){r.taskScore.push({value:parseInt(e.value),label:e.label})})),this.$route.meta.title="新增工单",l=this.$route.query,l.id?(this.form.id=this.$route.query,this.title="update",this.$route.meta.title="编辑工单",this.handleUpdate(l.id),this.header="Bearer "+Object(f["a"])(),this.myHeaders={Authorization:"Bearer "+Object(f["a"])()}):(this.form.id=0,this.newdata(),this.title="add",this.$route.meta.title="新增工单",this.header="Bearer "+Object(f["a"])(),this.myHeaders={Authorization:"Bearer "+Object(f["a"])()});case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:{getdeviceid:function(e){this.form.deviceId=e[0],this.form.deviceName=e[1],this.choosedevice=e[2],this.newdata()},tips:function(){this.form.deviceName||this.$message.error("请先选择设备!")},handleRemove:function(e,t){function a(e){var t=e.indexOf(".");return e=e.substring(t),".bmp"==e||".png"==e||".gif"==e||".jpg"==e||".jpeg"==e}if(a(e.name))var i=e.response.mediaId;else i=e.name;for(var l=0;l<this.faultMediaIdarr.length;l++)if(console.log(i,this.faultMediaIdarr[l]),console.log(i==this.faultMediaIdarr[l]),this.faultMediaIdarr[l]==i){this.faultMediaIdarr.splice(l,1);var r=this.faultMediaIdarr.join(",");this.form.faultMediaId=r}},handlePreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},handleExceed:function(e,t){this.$message.warning("当前限制选择 3 个文件，本次选择了 ".concat(e.length," 个文件，共选择了 ").concat(e.length+t.length," 个文件"))},select2:function(e){for(var t=0;t<this.faultUser.length;t++)e==this.faultUser[t].value&&(this.form.faultUserMobile=this.faultUserMobile[t].value)},select3:function(e){for(var t=0;t<this.taskStatus.length;t++)e==this.taskStatus[t].value&&(this.form.taskStatusName=this.taskStatus[t].label)},todevice:function(){this.choosedevice=!0},handleAvatarSuccess:function(e,t){if(1==e.code)alert("上传失败");else{this.faultMediaIdarr.push(e.mediaId);var a=this.faultMediaIdarr.join(",");this.form.faultMediaId=a}},beforeAvatarUpload:function(e){var t="image/jpeg"===e.type||"image/png",a=e.size/1024/1024<200,i=this.form.deviceId;return i||this.$message.error("请先选择设备名!"),t||this.$message.error("上传只能是图片格式!"),a||this.$message.error("上传图片大小不能超过 200MB!"),t&&a&&i},handleAdd:function(){var e=this;this.$refs.form.validate((function(t){if(!t)return!1;n["c"](e.form).then((function(t){"1"==t.data.code?e.$notify({title:"失败",message:"保存失败,"+t.data.msg,type:"error",duration:2e3}):"0"==t.data.code&&(e.$notify({title:"成功",message:"保存成功",type:"success",duration:2e3}),e.$router.push({path:"/task/index"}))}))}))},newdata:function(){if(this.form.taskStatusName="待派单",this.form.taskStatus=1,this.form.taskScore=2,this.form.faultUser=null,this.form.deviceId){for(var e=[],t=[],a=d["a"].taskchangephone,i=0;i<a.length;i++){var l=a[i],r=new Object({value:l.contactName,label:l.contactName}),n=new Object({value:l.contactMobile,label:l.contactMobile});e.push(r),t.push(n)}this.faultUser=e,this.faultUserMobile=t}if(this.form.faultMediaId){var s=this.form.faultMediaId.split(",");this.faultMediaIdarr=s;var o=[];for(i=0;i<s.length;i++){var u=new Object({name:s[i],url:"/admin/file/download?mediaId="+s[i]});o.push(u)}this.fileList=o}},handleUpdate:function(e){var t=d["a"].taskchange;t.latitude=t.latitude+"",t.longitude=t.longitude+"",this.form=t.taskOrder;for(var a=[],i=[],l=d["a"].taskchangephone,r=0;r<l.length;r++){var n=l[r],s=new Object({value:n.contactName,label:n.contactName}),o=new Object({value:n.contactMobile,label:n.contactMobile});a.push(s),i.push(o)}if(this.faultUser=a,this.faultUserMobile=i,this.form.faultMediaId){var u=this.form.faultMediaId.split(",");this.faultMediaIdarr=u;var c=[];for(r=0;r<u.length;r++){var f=new Object({name:u[r],url:"/admin/file/download?mediaId="+u[r]});c.push(f)}this.fileList=c}}}},m={deviceId:[{required:!0,message:"请输入内容",trigger:"blur"}],faultDesc:[{required:!0,message:"请输入内容",trigger:"blur"}],faultMediaId:[{required:!0,message:"请输入内容",trigger:"blur"}],taskStatus:[{required:!0,message:"请输入内容",trigger:"blur"}],faultUser:[{required:!0,message:"请输入内容",trigger:"blur"}],taskScore:[{required:!0,message:"请输入内容",trigger:"blur"}],faultUserMobile:[{required:!0,message:"请输入内容",trigger:"blur"}],faultType:[{required:!0,message:"请输入内容",trigger:"blur"}]},v=p,h=(a("6935"),a("0b56")),b=Object(h["a"])(v,i,l,!1,null,"530297dc",null);t["default"]=b.exports},b7e7:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-wrapper device-page-wrapper"},[a("s-title",{attrs:{title:"数据筛选"}}),e._v(" "),a("s-search",{on:{search:e.handleFilter,reset:e.handleReset}},[a("el-form-item",{attrs:{label:"设备编码:"}},[a("el-input",{attrs:{size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleFilter(t)}},model:{value:e.page.deviceCode,callback:function(t){e.$set(e.page,"deviceCode",t)},expression:"page.deviceCode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"设备名称:"}},[a("el-input",{attrs:{size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleFilter(t)}},model:{value:e.page.deviceName,callback:function(t){e.$set(e.page,"deviceName",t)},expression:"page.deviceName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"设备号码:"}},[a("el-input",{attrs:{size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleFilter(t)}},model:{value:e.page.deviceNo,callback:function(t){e.$set(e.page,"deviceNo",t)},expression:"page.deviceNo"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"设备SN码:"}},[a("el-input",{attrs:{size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleFilter(t)}},model:{value:e.page.deviceSn,callback:function(t){e.$set(e.page,"deviceSn",t)},expression:"page.deviceSn"}})],1)],1),e._v(" "),a("s-title",{attrs:{title:"数据列表"}}),e._v(" "),a("s-table",{attrs:{deviceImport:!1,add:!1,page:e.page},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange,handleAdd:e.handleAdd}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.list,"element-loading-text":"正在加载中...",border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{align:"center",label:"序号",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.getSerialNumber(t.$index)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"设备编码","min-width":"100px","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.deviceCode))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"设备名称","min-width":"200px","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.deviceName))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"设备号码","min-width":"160px","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.deviceNo))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"设备SN码","min-width":"200px","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.deviceSn))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"设备类型","min-width":"100px","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.deviceTypeName))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"设备用途","min-width":"100px","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.deviceUsesName))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"运营商","min-width":"100px","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.operator))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"所属项目","min-width":"200px","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.projectName))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"设备状态","min-width":"200px","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.status?a("span",[e._v("正常")]):e._e(),e._v(" "),1==t.row.status?a("span",[e._v("故障")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"150px",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"common-table-btn",on:{click:function(a){return e.totask(t.row.id,t.row.deviceName)}}},[e._v("选择当前设备")])]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.errorVisible,width:"900px"},on:{"update:visible":function(t){e.errorVisible=t}}},[a("div",{attrs:{slot:"title"},slot:"title"},[a("span",{staticStyle:{"font-size":"18px",color:"red"}},[e._v("导入错误")])]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.errorList,border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{align:"center",label:"错误信息",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.errorNum))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"错误内容"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.errorDesc))])]}}])})],1)],1)],1)},l=[],r=(a("ac67"),a("1bc7"),a("32ea"),a("3788")),n=a("023f"),s=a("b405"),o=a("1d14"),u=a("d077"),c=a("fab6"),d=a("52c1"),f=a("61f7"),p=a("7e1e");function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){Object(r["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var h={name:"Device",components:{STitle:s["default"],SSearch:o["default"],STable:u["default"]},mixins:[c["a"]],data:function(){return{dev_add:!1,dev_del:!1,dev_upd:!1,dev_detial:!1,dev_Import:!1,dev_Template:!1,errorList:[],errorVisible:!1,list:null,task:null,listLoading:!0}},mounted:function(){this.dev_add=!Object(f["g"])(this.permissions.dev_add),this.dev_del=!Object(f["g"])(this.permissions.dev_del),this.dev_upd=!Object(f["g"])(this.permissions.dev_upd),this.dev_detial=!Object(f["g"])(this.permissions.dev_detial),this.dev_Import=!Object(f["g"])(this.permissions.dev_Import),this.dev_Template=!Object(f["g"])(this.permissions.dev_Template);var e=this.$route.query;void 0!=e.task&&(this.task=e.task),this.getList()},computed:v(v({},Object(d["c"])({userInfo:function(e){return e.user.userInfo}})),Object(d["b"])(["permissions"])),methods:{totask:function(e,t){this.$emit("deviceid",[e,t,!1])},deviceImportTemplate:function(){n["d"]().then((function(e){if(console.log(n["d"].url),window.navigator.msSaveOrOpenBlob){var t=new Blob([e.data]);window.navigator.msSaveBlob(t,"设备导入模板.xlsx")}else{var a=document.createElement("a");a.style.display="none",a.href="/biz/device/getDeviceTemplate",a.setAttribute("download","设备导入模板.xlsx"),document.body.appendChild(a),a.click()}}))},deviceImportobj:function(e){var t=this;console.log(e);var a=new FormData;return a.append("file",e.file),n["c"](a).then((function(e){0===e.data.code?(t.getList(),t.$notify({title:"成功",message:"导入成功",type:"success",duration:2e3})):(t.errorVisible=!0,console.log("falg",e),t.errorList=e.data.errorList)})),!0},getList:function(){this.listLoading=!0,console.log(this.page);var e=p["a"].deviceindex;this.list=e.records,this.page.totalPage=e.total,this.listLoading=!1},handleAdd:function(){this.$router.push({path:"/device/add"})},deletes:function(e){var t=this;this.$confirm("此操作将永久删除该设备(设备编码："+e.deviceCode+"), 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){n["b"](e.id).then((function(){t.getList(),t.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3})})).catch((function(){t.$notify({title:"失败",message:"删除失败",type:"error",duration:2e3})}))}))}}},b=h,g=(a("1a9b"),a("0b56")),_=Object(g["a"])(b,i,l,!1,null,"f521cb12",null);t["default"]=_.exports},fcb1:function(e,t,a){}}]);